// @ts-nocheck
export default class CV{static#e="ABC";static#t=["poste","introduction","lastname","firstname","address","tel","mail","date_naissance","photo","permis","interests","linkedin","twitter","website","langue_name","langue_level","competence_name","competence_description","etude_date_deb","etude_date_fin","etude_lieu","etude_intitule","etude_description","experience_date_deb","experience_date_fin","experience_lieu","experience_intitule","experience_description"];#n;#a;constructor(e={}){this.#a=e.storage??localStorage,this.#n=this.#s()??{},this.#n.user=e.user??this.#n.user??{},this.#n.user.social??={},this.#n.user.experience??={},this.#n.user.etude??={},this.#n.user.competence??={},this.#n.user.langue??={},this.#n.theme=e.theme??this.#n.theme??{}}#r(e=this.#n){try{return this.#a.setItem(CV.#e,JSON.stringify(e)),!0}catch{return!1}}saveDataApp(e,t,n=this.#n){if(t===CV.#e||n[t])return n[t]={...n[t],...e},this.#r();for(const a of Object.keys(n))if("object"==typeof n[a]&&this.saveDataApp(e,t,n[a]))return!0;return!1}getDataApp(e=CV.#e,t=this.#n){if(e===CV.#e)return t;if(t[e])return t[e];for(const n of Object.keys(t))if("object"==typeof t[n]){const a=this.getDataApp(e,t[n]);if(a)return a}return null}#s(){const e=this.#a.getItem(CV.#e);return e&&e.includes("{")?JSON.parse(e):null}setUserInfo(e,t=!0){t?this.saveDataApp(e,"user",this.#n):this.#n.user={...this.#n.user,...e}}setThemeInfo(e,t=!0){t?this.saveDataApp(e,"theme",this.#n):this.#n.theme={...this.#n.theme,...e}}setThemeByForm(e){const t=e.querySelector("#templates"),n=e.querySelector("#couleurs"),a=t.querySelectorAll('input[name="choix_template"]'),s=n.querySelectorAll('input[name="choix_couleur"]');a.forEach((e=>{e&&e.addEventListener("change",(()=>{const t=e.getAttribute("data-template");t&&this.setThemeInfo({template:`./themes/templates/${t}/index.html`})}))})),s.forEach((e=>{e&&e.addEventListener("change",(()=>{const t=e.getAttribute("data-palette");t&&this.setThemeInfo({palette:`./themes/palette/${t}/style.css`})}))})),e.addEventListener("submit",(e=>{e.preventDefault(),location.href="./preview.html"}))}setThemePaletteByForm(e){const t=e.querySelector('input[type="radio"]');t.addEventListener("change",(()=>this.#n.theme.palette=`./themes/palette/${t.value}/style.css`))}setThemeTemplateByForm(e){const t=e.querySelector('input[type="radio"]');t.addEventListener("change",(()=>this.#n.theme.template=`./themes/template/${t.value}/index.html`))}displayUserInfoOnPreview(e){function t(t){return e.querySelectorAll(t)}const n=this.#n.user,a=[{champs:t("span.lastname"),value:n.lastname,type:"lastname"},{champs:t("span.firstname"),value:n.firstname,type:"firstname"},{champs:t("span.permis"),value:n.permis,type:"permis"},{champs:t("span.introduction"),value:n.introduction,type:"introduction"},{champs:t("span.fullname"),value:`${n.firstname} ${n.lastname}`,type:"fullname"},{champs:t("span.adresse"),value:n.address,type:"adresse"},{champs:t("span.poste"),value:n.poste,type:"poste"},{champs:t("span.interests"),value:n.interests,type:"interests"},{champs:t("span.tel"),value:n.tel,type:"tel"},{champs:t("span.mail"),value:n.mail,type:"mail"},{champs:t("span.linkedin"),value:n.social?.linkedin,type:"linkedin"},{champs:t("span.twitter"),value:n.social?.twitter,type:"twitter"},{champs:t("span.website"),value:n.social?.website,type:"website"},{champs:t("span.date_naissance"),value:n.date_naissance,type:"date_naissance"},{champs:t("#photo"),value:n.photo,type:"photo"},{champs:t("#competences"),value:n.competence,type:"competences"},{champs:t("#etudes"),value:n.etude,type:"etudes"},{champs:t("#experiences"),value:n.experience,type:"experiences"},{champs:t("#langues"),value:n.langue,type:"langues"}],s=["website","twitter","linkedin","competences","langues","etudes","experiences"];if(this.#n.theme.palette){const e=document.createElement("link");e.rel="stylesheet",e.href=this.#n.theme.palette,document.head.append(e)}for(const{champs:e,value:t,type:r}of Object.values(a))for(const a of e)"photo"===r?(a.src=t??"",a.alt="User's photo"):"string"==typeof t?a.textContent=t:s.includes(r)&&Array.isArray(t)?t.forEach((e=>{const t=document.createElement("ul");Object.entries(e).forEach((([e,n])=>{const a=document.createElement("li");a.textContent=n,t.append(a)})),a.append(t)})):["twitter","linkedin","website"].includes(r)&&(a.textContent=n.social[r])}displayAllInfoOnSummary(e){const t=document.createElement("h1");t.textContent="Récapitulatif de vos informations";const n=this.#c(),a=this.#o(),s=this.#p(),r=this.#i(),c=this.#l();e.append(t,n,a,s,r,c)}#l(){const e=document.createElement("section"),t=document.createElement("h2");t.textContent="Réseaux sociaux";const n=document.createElement("ul"),a=this.#n.user.social;return Object.entries(a).forEach((([e,t])=>{const a=document.createElement("li");switch(e){case"twitter":a.textContent=`Twitter : ${t}`;break;case"linkedin":a.textContent=`LinkedIn : ${t}`;break;case"website":a.textContent=`Site web : ${t}`;break;default:console.warn(`Clé (${e}) non pris en charge : ${t}`)}n.append(a)})),e.append(t,n),e}#i(){const e=document.createElement("section"),t=document.createElement("h2");t.textContent="Langues";const n=document.createElement("ul"),a=this.#n.user.langue;return Object.keys(a).forEach((e=>{const t=document.createElement("li"),s=document.createElement("ul");s.textContent=`Expérience : ${Number(e)+1}`,Object.entries(a[e]).forEach((([e,t])=>{const n=document.createElement("li");switch(e){case"nom":n.textContent=`Nom : ${t}`;break;case"niveau":n.textContent=`Niveau : ${t}`;break;default:console.warn(`Clé (${e}) non pris en charge : ${t}`)}s.append(n)})),t.append(s),n.append(t)})),e.append(t,n),e}#o(){const e=document.createElement("section"),t=document.createElement("h2");t.textContent="Expériences";const n=document.createElement("ul"),a=this.#n.user.experience;return Object.keys(a).forEach((e=>{const t=document.createElement("li"),s=document.createElement("ul");s.textContent=`Expérience : ${Number(e)+1}`,Object.entries(a[e]).forEach((([e,t])=>{const n=document.createElement("li");switch(e){case"intitule":n.textContent=`Intitulé : ${t}`;break;case"lieu":n.textContent=`Lieu : ${t}`;break;case"description":n.textContent=`Description : ${t}`;break;case"date_deb":n.textContent=`Date de début : ${t}`;break;case"date_fin":n.textContent=`Date de fin : ${t}`;break;default:console.warn(`Clé (${e}) non pris en charge : ${t}`)}s.append(n)})),t.append(s),n.append(t)})),e.append(t,n),e}#p(){const e=document.createElement("section"),t=document.createElement("h2");t.textContent="Compétences";const n=document.createElement("ul"),a=this.#n.user.competence;return Object.keys(a).forEach((e=>{const t=document.createElement("li"),s=document.createElement("ul");s.textContent=`Compétence : ${Number(e)+1}`,Object.entries(a[e]).forEach((([e,t])=>{const n=document.createElement("li");switch(e){case"nom":n.textContent=`Nom : ${t}`;break;case"description":n.textContent=`Description : ${t}`;break;default:console.warn(`Clé (${e}) non pris en charge : ${t}`)}s.append(n)})),t.append(s),n.append(t)})),e.append(t,n),e}#c(){const e=document.createElement("section"),t=document.createElement("h2");t.textContent="Informations personnel";const n=document.createElement("ul");return Object.entries(this.#n.user).forEach((([e,t])=>{if("object"!=typeof t){const a=document.createElement("li");switch(e){case"photo":const n=new Image;n.src=t,n.style.width="200px",n.style.height="auto",a.textContent="Photo de profil : ",a.append(n);break;case"poste":a.textContent=`Poste recherché : ${t}`;break;case"lastname":a.textContent=`Nom : ${t}`;break;case"firstname":a.textContent=`Prénom : ${t}`;break;case"introduction":a.textContent=`Introduction : ${t}`;break;case"date_naissance":const s=CV.computeAgeOfUser(t),r=s>=0?`(${s} ans)`:"",c=t?new Intl.DateTimeFormat("fr-FR",{dateStyle:"long"}).format(new Date(t)):"";a.textContent=`Date de naissance : ${c} ${r}`;break;case"tel":a.textContent=`Téléphone : ${t}`;break;case"mail":a.textContent=`Mail : ${t}`;break;case"address":a.textContent=`Adresse : ${t}`;break;case"permis":a.textContent=`Permis : ${t}`;break;default:console.warn(`Clé (${e}) non pris en charge : ${t}`)}n.append(a)}})),e.append(t,n),e}async setUserInfoByForm(e){e.addEventListener("submit",(async t=>{t.preventDefault();const n=e.querySelector("#global"),a=e.querySelector("#personal"),s=e.querySelector("#experiences"),r=e.querySelector("#competences"),c=e.querySelector("#langues"),o=e.querySelector("#social"),p=e.querySelector("#etudes");n.querySelectorAll("input").forEach((e=>{const t=e.name;CV.#t.includes(t)&&(this.#n.user[t]=e.value)})),o.querySelectorAll("input").forEach((e=>{const t=e.name;CV.#t.includes(t)&&(this.#n.user.social[t]=e.value)})),await Promise.all(Array.from(a.querySelectorAll("input")).map((async e=>{const t=e.name;CV.#t.includes(t)&&"photo"!==t?this.#n.user[t]=e.value:e.files.length>0&&(this.#n.user[t]=await CV.#u(e.files[0]))}))),this.#n.user.experience=this.#m(s),this.#n.user.competence=this.#d(r),this.#n.user.langue=this.#h(c),this.#n.user.etude=this.#y(p),this.#r(),location.href="./theme.form.html"}))}#h(e){const t=[];return e&&e.querySelectorAll(".langue").forEach((e=>{e&&t.push({nom:e.querySelector('input[name="langue_name"]')?.value,niveau:e.querySelector('input[name="langue_level"]')?.value})})),t}#y(e){const t=[];return e&&e.querySelectorAll(".etude").forEach((e=>{e&&t.push({date_deb:e.querySelector('input[name="etude_date_deb"]')?.value,date_fin:e.querySelector('input[name="etude_date_fin"]')?.value,lieu:e.querySelector('input[name="etude_lieu"]')?.value,intitule:e.querySelector('input[name="etude_intitule"]')?.value,description:e.querySelector('textarea[name="etude_description"]')?.value})})),t}#d(e){const t=[];return e&&e.querySelectorAll(".competence").forEach((e=>{e&&t.push({nom:e.querySelector('input[name="competence_name"]')?.value,description:e.querySelector('textarea[name="competence_description"]')?.value})})),t}#m(e){const t=[];return e&&e.querySelectorAll(".experience").forEach((e=>{e&&t.push({intitule:e.querySelector('input[name="experience_intitule"]')?.value,lieu:e.querySelector('input[name="experience_lieu"]')?.value,date_deb:e.querySelector('input[name="experience_date_deb"]')?.value,date_fin:e.querySelector('input[name="experience_date_fin"]')?.value,description:e.querySelector('textarea[name="experience_description"]')?.value})})),t}async exportToPDF(e,t,n={}){const{default:a}=await import("./pdf.min.js"),s=n.title??`CV${this.#n.user.lastname?` - ${this.#n.user.lastname}`:""}${this.#n.user.firstname?` ${this.#n.user.firstname}`:""}`;a.createButton(e,t,n={...n,title:s})}async exportToHTML(e,t,n={}){const{default:a}=await import("./htmlcss.min.js"),s=n.title??`CV${this.#n.user.lastname?` - ${this.#n.user.lastname}`:""}${this.#n.user.firstname?` ${this.#n.user.firstname}`:""}`,r=n.template??this.#n.theme.template??"";delete n.template,a.createButton(e,t,n={...n,title:s,template:r})}static computeAgeOfUser(e){if(!e)return-1;const t=new Date,n=new Date(e),a=t.getMonth()-n.getMonth(),s=a<0,r=0===a&&t.getDate()<n.getDate();let c=t.getFullYear()-n.getFullYear();return s||r?--c:c}static async#u(e){return new Promise((t=>{const n=new FileReader;n.onloadend=()=>t(n.result),n.readAsDataURL(e)}))}}