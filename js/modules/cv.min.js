// @ts-nocheck
export default class CV{static#e="ABC";static#t=["poste","introduction","lastname","firstname","address","tel","mail","date_naissance","photo","permis","interests","linkedin","twitter","website","langue_name","langue_level","competence_name","competence_description","etude_date_deb","etude_date_fin","etude_lieu","etude_intitule","etude_description","experience_date_deb","experience_date_fin","experience_lieu","experience_intitule","experience_description"];#a;#s;constructor(e={}){this.#s=e.storage??localStorage,this.#a=this.#n()??{},this.#a.user=e.user??this.#a.user??{},this.#a.user.social??={},this.#a.user.experience??={},this.#a.user.etude??={},this.#a.user.competence??={},this.#a.user.langue??={},this.#a.theme=e.theme??this.#a.theme??{}}#r(e=this.#a){try{return this.#s.setItem(CV.#e,JSON.stringify(e)),!0}catch{return!1}}saveDataApp(e,t,a=this.#a){if(t===CV.#e||a[t])return a[t]={...a[t],...e},this.#r();for(const s of Object.keys(a))if("object"==typeof a[s]&&this.saveDataApp(e,t,a[s]))return!0;return!1}getDataApp(e=CV.#e,t=this.#a){if(e===CV.#e)return t;if(t[e])return t[e];for(const a of Object.keys(t))if("object"==typeof t[a]){const s=this.getDataApp(e,t[a]);if(s)return s}return null}#n(){const e=this.#s.getItem(CV.#e);return e&&e.includes("{")?JSON.parse(e):null}setUserInfo(e,t=!0){t?this.saveDataApp(e,"user",this.#a):this.#a.user={...this.#a.user,...e}}setThemeInfo(e,t=!0){t?this.saveDataApp(e,"theme",this.#a):this.#a.theme={...this.#a.theme,...e}}setThemeByForm(e){const t=e.querySelector("#templates"),a=e.querySelector("#couleurs"),s=t.querySelectorAll('input[name="choix_template"]'),n=a.querySelectorAll('input[name="choix_couleur"]');s.forEach((e=>{e&&e.addEventListener("change",(()=>{const t=e.getAttribute("data-template");t&&this.setThemeInfo({template:`./themes/templates/${t}/index.html`})}))})),n.forEach((e=>{e&&e.addEventListener("change",(()=>{const t=e.getAttribute("data-palette");t&&this.setThemeInfo({palette:`./themes/palette/${t}/style.css`})}))})),e.addEventListener("submit",(e=>{e.preventDefault(),location.href="./preview.html"}))}setThemePaletteByForm(e){const t=e.querySelector('input[type="radio"]');t.addEventListener("change",(()=>this.#a.theme.palette=`./themes/palette/${t.value}/style.css`))}setThemeTemplateByForm(e){const t=e.querySelector('input[type="radio"]');t.addEventListener("change",(()=>this.#a.theme.template=`./themes/template/${t.value}/index.html`))}displayUserInfoOnPreview(e){function t(t){return e.querySelectorAll(t)}const a=this.#a.user,s=[{champs:t("span.lastname"),value:a.lastname,type:"lastname"},{champs:t("span.firstname"),value:a.firstname,type:"firstname"},{champs:t("span.permis"),value:a.permis,type:"permis"},{champs:t("span.introduction"),value:a.introduction,type:"introduction"},{champs:t("span.fullname"),value:`${a.firstname} ${a.lastname}`,type:"fullname"},{champs:t("span.adresse"),value:a.address,type:"adresse"},{champs:t("span.poste"),value:a.poste,type:"poste"},{champs:t("span.interests"),value:a.interests,type:"interests"},{champs:t("span.tel"),value:a.tel,type:"tel"},{champs:t("span.mail"),value:a.mail,type:"mail"},{champs:t("span.linkedin"),value:a.social?.linkedin,type:"linkedin"},{champs:t("span.twitter"),value:a.social?.twitter,type:"twitter"},{champs:t("span.website"),value:a.social?.website,type:"website"},{champs:t("span.date_naissance"),value:a.date_naissance,type:"date_naissance"},{champs:t("#photo"),value:a.photo,type:"photo"},{champs:t("#competences"),value:a.competence,type:"competences"},{champs:t("#etudes"),value:a.etude,type:"etudes"},{champs:t("#experiences"),value:a.experience,type:"experiences"},{champs:t("#langues"),value:a.langue,type:"langues"}],n=["website","twitter","linkedin","competences","langues","etudes","experiences"];if(this.#a.theme.palette){const e=document.createElement("link");e.rel="stylesheet",e.href=this.#a.theme.palette,document.head.append(e)}for(const{champs:e,value:t,type:r}of Object.values(s))for(const s of e)"photo"===r?(s.src=t??"",s.alt="User's photo"):"string"==typeof t?s.textContent=t:n.includes(r)&&Array.isArray(t)?t.forEach((e=>{const t=document.createElement("ul");Object.entries(e).forEach((([e,a])=>{const s=document.createElement("li");s.textContent=a,t.append(s)})),s.append(t)})):["twitter","linkedin","website"].includes(r)&&(s.textContent=a.social[r])}async setUserInfoByForm(e){e.addEventListener("submit",(t=>{t.preventDefault();const a=e.querySelector("#global"),s=e.querySelector("#personal"),n=e.querySelector("#experiences"),r=e.querySelector("#competences"),p=e.querySelector("#langues"),i=e.querySelector("#social"),l=e.querySelector("#etudes");a.querySelectorAll("input").forEach((e=>{const t=e.name;CV.#t.includes(t)&&(this.#a.user[t]=e.value)})),i.querySelectorAll("input").forEach((e=>{const t=e.name;CV.#t.includes(t)&&(this.#a.user.social[t]=e.value)})),s.querySelectorAll("input").forEach((async e=>{CV.#t.includes(e.name)&&(this.#a.user.photo=await CV.#p(e.files[0]))})),this.#a.user.experience=this.#i(n),this.#a.user.competence=this.#l(r),this.#a.user.langue=this.#u(p),this.#a.user.etude=this.#o(l),this.#r(),location.href="./theme.form.html"}))}#u(e){const t=[];return e&&e.querySelectorAll(".langue").forEach((e=>{e&&t.push({nom:e.querySelector('input[name="langue_name"]')?.value,niveau:e.querySelector('input[name="langue_level"]')?.value})})),t}#o(e){const t=[];return e&&e.querySelectorAll(".etude").forEach((e=>{e&&t.push({date_deb:e.querySelector('input[name="etude_date_deb"]')?.value,date_fin:e.querySelector('input[name="etude_date_fin"]')?.value,lieu:e.querySelector('input[name="etude_lieu"]')?.value,intitule:e.querySelector('input[name="etude_intitule"]')?.value,description:e.querySelector('textarea[name="etude_description"]')?.value})})),t}#l(e){const t=[];return e&&e.querySelectorAll(".competence").forEach((e=>{e&&t.push({nom:e.querySelector('input[name="competence_name"]')?.value,description:e.querySelector('textarea[name="competence_description"]')?.value})})),t}#i(e){const t=[];return e&&e.querySelectorAll(".experience").forEach((e=>{e&&t.push({intitule:e.querySelector('input[name="experience_intitule"]')?.value,lieu:e.querySelector('input[name="experience_lieu"]')?.value,date_deb:e.querySelector('input[name="experience_date_deb"]')?.value,date_fin:e.querySelector('input[name="experience_date_fin"]')?.value,description:e.querySelector('textarea[name="experience_description"]')?.value})})),t}async exportToPDF(e,t,a={}){const{default:s}=await import("./pdf.min.js"),n=a.title??`CV${this.#a.user.lastname?` - ${this.#a.user.lastname}`:""}${this.#a.user.firstname?` ${this.#a.user.firstname}`:""}`;s.createButton(e,t,a={...a,title:n})}async exportToHTML(e,t,a={}){const{default:s}=await import("./htmlcss.min.js"),n=a.title??`CV${this.#a.user.lastname?` - ${this.#a.user.lastname}`:""}${this.#a.user.firstname?` ${this.#a.user.firstname}`:""}`,r=a.template??this.#a.theme.template??"";delete a.template,s.createButton(e,t,a={...a,title:n,template:r})}static computeAgeOfUser(e){if(!e)return-1;const t=new Date,a=new Date(e),s=t.getMonth()-a.getMonth(),n=s<0,r=0===s&&t.getDate()<a.getDate();let p=t.getFullYear()-a.getFullYear();return n||r?--p:p}static async#p(e){return new Promise((t=>{const a=new FileReader;a.onloadend=()=>t(a.result),a.readAsDataURL(e)}))}}