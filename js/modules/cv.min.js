export default class e{static #a="ABC";static #b=["lastname","firstname","poste","address","tel","mail","linkedin","twitter","website","date_naissance","photo","langue_name","langue_level","competence_name","competence_description","etude_date_deb","etude_date_fin","etude_lieu","etude_intitule","etude_description","experience_date_deb","experience_date_fin","experience_lieu","experience_intitule","experience_description","interests"];#c;#d;constructor(e={}){this.#d=e.storage??localStorage,this.#c=this.#e()??{},this.#c.user=e.user??this.#c.user??{},this.#c.theme=e.theme??this.#c.theme??{}}#f(t=this.#c){try{return this.#d.setItem(e.#a,JSON.stringify(t)),!0}catch{return!1}}saveDataApp(t,s,a=this.#c){if(s===e.#a||a[s])return a[s]={...a[s],...t},this.#f();for(let i of Object.keys(a))if("object"==typeof a[i]&&this.saveDataApp(t,s,a[i]))return!0;return!1}getDataApp(t=e.#a,s=this.#c){if(t===e.#a)return s;if(s[t])return s[t];for(let a of Object.keys(s))if("object"==typeof s[a]){let i=this.getDataApp(t,s[a]);if(i)return i}return null}#e(){let s=this.#d.getItem(e.#a);return s&&s.includes("{")?JSON.parse(s):null}setUserInfo(e,t=!0){t?this.saveDataApp(e,"user",this.#c):this.#c.user={...this.#c.user,...e}}setThemeInfo(e,t=!0){t?this.saveDataApp(e,"theme",this.#c):this.#c.theme={...this.#c.theme,...e}}setThemeByForm(e){let t=e.querySelector('input[type="radio"]');t&&t.addEventListener("change",()=>{switch(t.name){case"choix_couleur":this.setThemeInfo({palette:t.value});break;case"choix_template":this.setThemeInfo({template:t.value})}})}setThemePaletteByForm(e){let t=e.querySelector('input[type="radio"]');t.addEventListener("change",()=>this.#c.theme.palette=`./themes/palette/${t.value}/style.css`)}setThemeTemplateByForm(e){let t=e.querySelector('input[type="radio"]');t.addEventListener("change",()=>this.#c.theme.template=`./themes/template/${t.value}/index.html`)}displayUserInfoOnPreview(e){function t(t){return e.querySelectorAll(t)}let s=this.#c.user,a=[{champs:t("span.lastname"),value:s.lastname,type:"lastname"},{champs:t("span.firstname"),value:s.firstname,type:"firstname"},{champs:t("span.fullname"),value:`${s.firstname} ${s.lastname}`,type:"fullname"},{champs:t("span.adresse"),value:s.address,type:"adresse"},{champs:t("span.poste"),value:s.poste,type:"poste"},{champs:t("span.interests"),value:s.interests,type:"interests"},{champs:t("span.tel"),value:s.tel,type:"tel"},{champs:t("span.mail"),value:s.mail,type:"mail"},{champs:t("span.linkedin"),value:s.social?.linkedin,type:"linkedin"},{champs:t("span.twitter"),value:s.social?.twitter,type:"twitter"},{champs:t("span.website"),value:s.social?.website,type:"website"},{champs:t("span.date_naissance"),value:s.date_naissance,type:"date_naissance"},{champs:t("#photo"),value:s.photo,type:"photo"},{champs:t("#competences"),value:s.competence,type:"competences"},{champs:t("#etudes"),value:s.etude,type:"etudes"},{champs:t("#experiences"),value:s.experience,type:"experiences"},{champs:t("#langues"),value:s.langue,type:"langues"}],i=["website","twitter","linkedin","competences","langues","etudes","experiences"];for(let{champs:n,value:r,type:l}of Object.values(a))for(let c of n)"photo"===l?(c.src=r??"",c.alt="User's photo"):"string"==typeof r?c.textContent=r:i.includes(l)&&Array.isArray(r)?r.forEach(e=>{let t=document.createElement("ul");Object.entries(e).forEach(([e,s])=>{let a=document.createElement("li");a.textContent=s,t.append(a)}),c.append(t)}):["twitter","linkedin","website"].includes(l)&&(c.textContent=s.social[l])}async setUserInfoByForm(t){t.addEventListener("submit",t=>{t.preventDefault(),document.querySelectorAll("input").forEach(async t=>{let s=t.name,a=t.value;e.#b.includes(s)&&(this.#c.user.social??={},this.#c.user.experience??={},this.#c.user.etude??={},this.#c.user.competence??={},this.#c.user.langue??={},t.hasAttribute("data-social")?this.#c.user.social[s]=a:t.hasAttribute("data-photo")?this.#c.user.photo=await e.#g(t.files[0]):t.hasAttribute("data-competence")?this.#c.user.competence.push({[s]:a}):t.hasAttribute("data-etude")?this.#c.user.etude.push({[s]:a}):t.hasAttribute("data-experience")?this.#c.user.experience.push({[s]:a}):t.hasAttribute("data-langues")?this.#c.user.langue.push({[s]:a}):this.#c.user[s]=a)}),this.#f(),location.href="./form.theme.html"})}async exportToPDF(e,t,s={}){let{default:a}=await import("./pdf.min.js"),i=s.title??`CV${this.#c.user.lastname?` - ${this.#c.user.lastname}`:""}${this.#c.user.firstname?` ${this.#c.user.firstname}`:""}`;a.createButton(e,t,s={...s,title:i})}async exportToHTML(e,t,s={}){let{default:a}=await import("./htmlcss.min.js"),i=s.title??`CV${this.#c.user.lastname?` - ${this.#c.user.lastname}`:""}${this.#c.user.firstname?` ${this.#c.user.firstname}`:""}`,n=s.template??this.#c.theme.template??"";delete s.template,a.createButton(e,t,s={...s,title:i,template:n})}static computeAgeOfUser(e){if(!e)return -1;let t=new Date,s=new Date(e),a=t.getMonth()-s.getMonth(),i=0===a&&t.getDate()<s.getDate(),n=t.getFullYear()-s.getFullYear();return a<0||i?--n:n}static async #g(a){return new Promise(e=>{let t=new FileReader;t.onloadend=()=>e(t.result),t.readAsDataURL(a)})}};