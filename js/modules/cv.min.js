// @ts-nocheck
export default class CV{static#e="ABC";static#t=["lastname","firstname","poste","address","tel","mail","linkedin","twitter","website","date_naissance","photo"];#s;#a;constructor(e={}){this.#a=e.storage??localStorage,this.#s=this.#p()??{},this.#s.user=e.user??this.#s.user??{},this.#s.theme=e.theme??this.#s.theme??{}}#r(e=this.#s){try{return this.#a.setItem(CV.#e,JSON.stringify(e)),!0}catch{return!1}}saveDataApp(e,t,s=this.#s){if(t===CV.#e||s[t])return s[t]={...s[t],...e},this.#r();for(const a of Object.keys(s))if("object"==typeof s[a]&&this.saveDataApp(e,t,s[a]))return!0;return!1}getDataApp(e=CV.#e,t=this.#s){if(e===CV.#e)return t;if(t[e])return t[e];for(const s of Object.keys(t))if("object"==typeof t[s]){const a=this.getDataApp(e,t[s]);if(a)return a}return null}#p(){const e=this.#a.getItem(CV.#e);return e&&e.includes("{")?JSON.parse(e):null}setUserInfo(e,t=!0){t?this.saveDataApp(e,"user",this.#s):this.#s.user={...this.#s.user,...e}}setThemeInfo(e,t=!0){t?this.saveDataApp(e,"theme",this.#s):this.#s.theme={...this.#s.theme,...e}}async setUserInfoByForm(e){e.addEventListener("submit",(e=>{e.preventDefault(),document.querySelectorAll("input").forEach((async e=>{const t=e.name,s=e.value;CV.#t.includes(t)&&(this.#s.user.social??={},this.#s.user.experience??={},this.#s.user.etude??={},this.#s.user.competence??={},e.hasAttribute("data-social")?this.#s.user.social[t]=s:e.hasAttribute("data-photo")?this.#s.user.photo=await this.convertImageToBase64(e.files[0]):e.hasAttribute("data-competence")?this.#s.user.competence.push({[t]:s}):e.hasAttribute("data-etude")?this.#s.user.etude.push({[t]:s}):e.hasAttribute("data-experience")?this.#s.user.experience.push({[t]:s}):this.#s.user[t]=s)})),this.#r()}))}setThemePaletteByForm(e){const t=e.querySelector('input[type="radio"]');t.addEventListener("change",(()=>this.#s.theme.palette=`./themes/palette/${t.value}/style.css`))}setThemeTemplateByForm(e){const t=e.querySelector('input[type="radio"]');t.addEventListener("change",(()=>this.#s.theme.template=`./themes/template/${t.value}/index.html`))}displayUserInfoOnPreview(e){this.#s.user.firstname,this.#s.user.lastname;e.querySelectorAll("span.lastname").forEach((e=>{e.textContent=this.#s.user.lastname}))}async convertImageToBase64(e){return new Promise(((t,s)=>{const a=new FileReader;a.onloadend=()=>t(a.result),a.onerror=s,a.readAsDataURL(e)}))}async exportToPDF(e,t,s={}){const{default:a}=await import("./pdf.mjs"),p=s.title??`CV${this.#s.user.lastname?` - ${this.#s.user.lastname}`:""}${this.#s.user.firstname?` ${this.#s.user.firstname}`:""}`;a.createButton(e,t,s={...s,title:p})}async exportToHTML(e,t,s=this.#s.theme.template,a={}){const{default:p}=await import("./htmlcss.mjs"),r=a.title??`CV${this.#s.user.lastname?` - ${this.#s.user.lastname}`:""}${this.#s.user.firstname?` ${this.#s.user.firstname}`:""}`;p.createButton(e,t,s,a={...a,title:r})}static computeAgeOfUser(e){if(!e)return-1;const t=new Date,s=new Date(e),a=t.getMonth()-s.getMonth(),p=a<0,r=0===a&&t.getDate()<s.getDate();let i=t.getFullYear()-s.getFullYear();return p||r?--i:i}}const cv=new CV;cv.setUserInfoByForm(document.getElementById("user"));