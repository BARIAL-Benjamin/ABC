// @ts-nocheck
export default class CV{static#e="ABC";static#t=["lastname","firstname","poste","address","tel","mail","linkedin","twitter","website","date_naissance","photo","langue_name","langue_level","competence_name","competence_description","etude_date_deb","etude_date_fin","etude_lieu","etude_intitule","etude_description","experience_date_deb","experience_date_fin","experience_lieu","experience_intitule","experience_description","interests"];#a;#s;constructor(e={}){this.#s=e.storage??localStorage,this.#a=this.#p()??{},this.#a.user=e.user??this.#a.user??{},this.#a.theme=e.theme??this.#a.theme??{}}#n(e=this.#a){try{return this.#s.setItem(CV.#e,JSON.stringify(e)),!0}catch{return!1}}saveDataApp(e,t,a=this.#a){if(t===CV.#e||a[t])return a[t]={...a[t],...e},this.#n();for(const s of Object.keys(a))if("object"==typeof a[s]&&this.saveDataApp(e,t,a[s]))return!0;return!1}getDataApp(e=CV.#e,t=this.#a){if(e===CV.#e)return t;if(t[e])return t[e];for(const a of Object.keys(t))if("object"==typeof t[a]){const s=this.getDataApp(e,t[a]);if(s)return s}return null}#p(){const e=this.#s.getItem(CV.#e);return e&&e.includes("{")?JSON.parse(e):null}setUserInfo(e,t=!0){t?this.saveDataApp(e,"user",this.#a):this.#a.user={...this.#a.user,...e}}setThemeInfo(e,t=!0){t?this.saveDataApp(e,"theme",this.#a):this.#a.theme={...this.#a.theme,...e}}setThemeByForm(e){const t=e.querySelector('input[type="radio"]');t&&t.addEventListener("change",(()=>{switch(t.name){case"choix_couleur":this.setThemeInfo({palette:t.value});break;case"choix_template":this.setThemeInfo({template:t.value})}}))}setThemePaletteByForm(e){const t=e.querySelector('input[type="radio"]');t.addEventListener("change",(()=>this.#a.theme.palette=`./themes/palette/${t.value}/style.css`))}setThemeTemplateByForm(e){const t=e.querySelector('input[type="radio"]');t.addEventListener("change",(()=>this.#a.theme.template=`./themes/template/${t.value}/index.html`))}displayUserInfoOnPreview(e){function t(t){return e.querySelectorAll(t)}const a=this.#a.user,s=[{champs:t("span.lastname"),value:a.lastname,type:"lastname"},{champs:t("span.firstname"),value:a.firstname,type:"firstname"},{champs:t("span.fullname"),value:`${a.firstname} ${a.lastname}`,type:"fullname"},{champs:t("span.adresse"),value:a.address,type:"adresse"},{champs:t("span.poste"),value:a.poste,type:"poste"},{champs:t("span.interests"),value:a.interests,type:"interests"},{champs:t("span.tel"),value:a.tel,type:"tel"},{champs:t("span.mail"),value:a.mail,type:"mail"},{champs:t("span.linkedin"),value:a.social?.linkedin,type:"linkedin"},{champs:t("span.twitter"),value:a.social?.twitter,type:"twitter"},{champs:t("span.website"),value:a.social?.website,type:"website"},{champs:t("span.date_naissance"),value:a.date_naissance,type:"date_naissance"},{champs:t("#photo"),value:a.photo,type:"photo"},{champs:t("#competences"),value:a.competence,type:"competences"},{champs:t("#etudes"),value:a.etude,type:"etudes"},{champs:t("#experiences"),value:a.experience,type:"experiences"},{champs:t("#langues"),value:a.langue,type:"langues"}],p=["website","twitter","linkedin","competences","langues","etudes","experiences"];for(const{champs:e,value:t,type:n}of Object.values(s))for(const s of e)"photo"===n?(s.src=t??"",s.alt="User's photo"):"string"==typeof t?s.textContent=t:p.includes(n)&&Array.isArray(t)?t.forEach((e=>{const t=document.createElement("ul");Object.entries(e).forEach((([e,a])=>{const s=document.createElement("li");s.textContent=a,t.append(s)})),s.append(t)})):["twitter","linkedin","website"].includes(n)&&(s.textContent=a.social[n])}async setUserInfoByForm(e){e.addEventListener("submit",(e=>{e.preventDefault(),document.querySelectorAll("input").forEach((async e=>{const t=e.name,a=e.value;CV.#t.includes(t)&&(this.#a.user.social??={},this.#a.user.experience??={},this.#a.user.etude??={},this.#a.user.competence??={},this.#a.user.langue??={},e.hasAttribute("data-social")?this.#a.user.social[t]=a:e.hasAttribute("data-photo")?this.#a.user.photo=await CV.#i(e.files[0]):e.hasAttribute("data-competence")?this.#a.user.competence.push({[t]:a}):e.hasAttribute("data-etude")?this.#a.user.etude.push({[t]:a}):e.hasAttribute("data-experience")?this.#a.user.experience.push({[t]:a}):e.hasAttribute("data-langues")?this.#a.user.langue.push({[t]:a}):this.#a.user[t]=a)})),this.#n(),location.href="./form.theme.html"}))}static async#i(e){return new Promise((t=>{const a=new FileReader;a.onloadend=()=>t(a.result),a.readAsDataURL(e)}))}async exportToPDF(e,t,a={}){const{default:s}=await import("./pdf.mjs"),p=a.title??`CV${this.#a.user.lastname?` - ${this.#a.user.lastname}`:""}${this.#a.user.firstname?` ${this.#a.user.firstname}`:""}`;s.createButton(e,t,a={...a,title:p})}async exportToHTML(e,t,a={}){const{default:s}=await import("./htmlcss.mjs"),p=a.title??`CV${this.#a.user.lastname?` - ${this.#a.user.lastname}`:""}${this.#a.user.firstname?` ${this.#a.user.firstname}`:""}`,n=a.template??this.#a.theme.template??"";delete a.template,s.createButton(e,t,a={...a,title:p,template:n})}static computeAgeOfUser(e){if(!e)return-1;const t=new Date,a=new Date(e),s=t.getMonth()-a.getMonth(),p=s<0,n=0===s&&t.getDate()<a.getDate();let i=t.getFullYear()-a.getFullYear();return p||n?--i:i}}